name: Update Dependencies

on:
  schedule:
    # à¸£à¸±à¸™à¸—à¸¸à¸à¸§à¸±à¸™à¸ˆà¸±à¸™à¸—à¸£à¹Œ à¹€à¸§à¸¥à¸² 9:00 UTC
    - cron: '0 9 * * 1'
  workflow_dispatch: # à¸ªà¸²à¸¡à¸²à¸£à¸–à¸£à¸±à¸™à¸”à¹‰à¸§à¸¢à¸•à¸±à¸§à¹€à¸­à¸‡à¹„à¸”à¹‰

jobs:
  update:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Bun
        uses: oven-sh/setup-bun@v2
        with:
          bun-version: latest

      - name: Check for updates
        run: |
          bun outdated
          echo "ğŸ“¦ Checking for dependency updates..."

      - name: Update dependencies
        run: |
          bun update
          echo "âœ… Dependencies updated!"

      - name: Run tests
        run: |
          bun install
          bun test
          bun run typecheck
          bun run lint

      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: 'chore: update dependencies'
          title: 'ğŸ”„ Weekly Dependency Updates'
          body: |
            ## ğŸ“¦ Dependency Updates
            
            This PR updates dependencies to their latest versions.
            
            ### Changes
            - Updated all dependencies to latest compatible versions
            - All tests passing âœ…
            - Type checking passed âœ…
            - Linting passed âœ…
            
            Please review and merge if everything looks good!
          branch: deps/weekly-update
          labels: dependencies, automated
